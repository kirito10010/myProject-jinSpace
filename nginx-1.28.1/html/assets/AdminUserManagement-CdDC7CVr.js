import{d as P,k as Q,c as W,a as A,b as a,w as o,h as u,E as n,r,o as X,e as M,G as D,g as d,x as E,H as Y,i as I,I as L}from"./index-8fw8rqfs.js";import{s as V}from"./request-Z1Oqv7c5.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae=async()=>V.get("/api/admin/users"),le=async(m,v)=>V.put(`/api/admin/users/${m}`,v),te=async m=>V.delete(`/api/admin/users/${m}`),se=async m=>V.delete("/api/admin/users/batch",{data:m}),oe={class:"admin-user-management"},ne={class:"toolbar"},re={class:"dialog-footer"},ue=P({__name:"AdminUserManagement",setup(m){const v=u([]),k=u(!1),x=u(),c=u(!1),b=u(!1),T=u(0),h=u(!1),U=u(0),C=u(!1),g=u([]),t=I({id:0,username:"",password:"",nickname:"",email:"",role:3,status:1}),S=I({username:[{required:!0,message:"请输入登录账号",trigger:"blur"},{min:3,max:50,message:"登录账号长度在 3 到 50 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"登录账号只能包含字母、数字和下划线",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}],status:[{required:!0,message:"请选择账号状态",trigger:"change"}],password:[{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]}),z=l=>({1:"超级管理员",2:"管理员",3:"普通成员"})[l]||"未知角色",F=l=>l===1?"正常":"禁用",w=async()=>{try{k.value=!0;const l=await ae();l.success?v.value=l.data:n.error(l.message||"获取用户列表失败")}catch(l){n.error("获取用户列表失败："+l.message)}finally{k.value=!1}},N=l=>{g.value=l.map(e=>e.id)},R=l=>{t.id=l.id,t.username=l.username,t.nickname=l.nickname,t.email=l.email,t.role=l.role,t.status=l.status,t.password="",T.value=l.id,c.value=!0},G=async()=>{if(x.value)try{await x.value.validate(),b.value=!0;const l={username:t.username,nickname:t.nickname,email:t.email,role:t.role,status:t.status};t.password&&(l.password=t.password);const e=await le(t.id,l);e.success?(n.success("更新用户成功"),c.value=!1,w()):n.error(e.message||"更新用户失败")}catch(l){n.error("更新用户失败："+l.message)}finally{b.value=!1}},H=async l=>{try{await L.confirm("确定要删除该用户吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),U.value=l.id,h.value=!0;const e=await te(l.id);e.success?(n.success("删除用户成功"),w()):n.error(e.message||"删除用户失败")}catch(e){e!=="cancel"&&n.error("删除用户失败："+e.message)}finally{h.value=!1,U.value=0}},Z=async()=>{if(g.value.length===0){n.warning("请选择要删除的用户");return}try{await L.confirm("确定要删除选中的用户吗？","批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=!0;const l=await se(g.value);l.success?(n.success("批量删除用户成功"),w(),g.value=[]):n.error(l.message||"批量删除用户失败")}catch(l){l!=="cancel"&&n.error("批量删除用户失败："+l.message)}finally{C.value=!1}};return Q(()=>{w()}),(l,e)=>{const B=r("el-icon"),f=r("el-button"),i=r("el-table-column"),$=r("el-tag"),j=r("el-table"),y=r("el-input"),p=r("el-form-item"),_=r("el-option"),q=r("el-select"),J=r("el-form"),K=r("el-dialog");return X(),W("div",oe,[e[13]||(e[13]=A("h1",null,"用戶管理",-1)),A("div",ne,[a(f,{type:"danger",disabled:g.value.length===0,onClick:Z,loading:C.value},{default:o(()=>[a(B,null,{default:o(()=>[a(M(D))]),_:1}),e[8]||(e[8]=d(" 批量删除 ",-1))]),_:1},8,["disabled","loading"])]),a(j,{data:v.value,style:{width:"100%"},onSelectionChange:N,loading:k.value,stripe:"",border:""},{default:o(()=>[a(i,{type:"selection",width:"55"}),a(i,{prop:"username",label:"登录账号",width:"180"}),a(i,{prop:"nickname",label:"用户昵称",width:"180"}),a(i,{prop:"email",label:"邮箱","min-width":"200"}),a(i,{prop:"role",label:"用户权限",width:"120"},{default:o(s=>[a($,{type:s.row.role===1?"danger":s.row.role===2?"warning":"success"},{default:o(()=>[d(E(z(s.row.role)),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"status",label:"账号状态",width:"120"},{default:o(s=>[a($,{type:s.row.status===1?"success":"danger"},{default:o(()=>[d(E(F(s.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(i,{label:"操作",width:"180",fixed:"right"},{default:o(s=>[a(f,{type:"primary",size:"small",onClick:O=>R(s.row),loading:b.value&&T.value===s.row.id},{default:o(()=>[a(B,null,{default:o(()=>[a(M(Y))]),_:1}),e[9]||(e[9]=d(" 修改 ",-1))]),_:1},8,["onClick","loading"]),a(f,{type:"danger",size:"small",onClick:O=>H(s.row),loading:h.value&&U.value===s.row.id},{default:o(()=>[a(B,null,{default:o(()=>[a(M(D))]),_:1}),e[10]||(e[10]=d(" 删除 ",-1))]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data","loading"]),a(K,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=s=>c.value=s),title:"编辑用户",width:"500px","destroy-on-close":""},{footer:o(()=>[A("span",re,[a(f,{onClick:e[6]||(e[6]=s=>c.value=!1)},{default:o(()=>[...e[11]||(e[11]=[d("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:G,loading:b.value},{default:o(()=>[...e[12]||(e[12]=[d(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[a(J,{model:t,rules:S,ref_key:"editFormRef",ref:x,"label-width":"80px"},{default:o(()=>[a(p,{label:"登录账号",prop:"username"},{default:o(()=>[a(y,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=s=>t.username=s),placeholder:"登录账号"},null,8,["modelValue"])]),_:1}),a(p,{label:"密码",prop:"password"},{default:o(()=>[a(y,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=s=>t.password=s),type:"password",placeholder:"不修改密码请留空","show-password":""},null,8,["modelValue"])]),_:1}),a(p,{label:"昵称",prop:"nickname"},{default:o(()=>[a(y,{modelValue:t.nickname,"onUpdate:modelValue":e[2]||(e[2]=s=>t.nickname=s),placeholder:"用户昵称"},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:o(()=>[a(y,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.email=s),placeholder:"用户邮箱",type:"email"},null,8,["modelValue"])]),_:1}),a(p,{label:"角色",prop:"role"},{default:o(()=>[a(q,{modelValue:t.role,"onUpdate:modelValue":e[4]||(e[4]=s=>t.role=s),placeholder:"请选择用户角色"},{default:o(()=>[a(_,{label:"超级管理员",value:1}),a(_,{label:"管理员",value:2}),a(_,{label:"普通成员",value:3})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"状态",prop:"status"},{default:o(()=>[a(q,{modelValue:t.status,"onUpdate:modelValue":e[5]||(e[5]=s=>t.status=s),placeholder:"请选择账号状态"},{default:o(()=>[a(_,{label:"正常",value:1}),a(_,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),pe=ee(ue,[["__scopeId","data-v-4f0869c5"]]);export{pe as default};
