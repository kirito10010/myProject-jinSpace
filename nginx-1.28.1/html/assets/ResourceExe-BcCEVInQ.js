import{d as ve,k as ge,c as _e,a as m,b as l,w as t,K as be,z as we,C as he,h as c,i as ye,E as n,r as i,L as Ve,o as A,e as w,M as P,g as u,Q as R,D as B,O as W,p as xe,R as Ce,P as K}from"./index-10ag5i-E.js";import{a as U}from"./index-B9ygI19o.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"resource-url-container"},Ue={class:"page-header"},ke={class:"header-buttons"},Me={class:"table-container"},Be={class:"action-buttons"},De={class:"pagination-container"},Ee={class:"upload-form"},Ie={class:"dialog-footer"},Ne={class:"dialog-footer"},j="/api/installer-files/upload",Te=ve({__name:"ResourceExe",setup(Fe){const C=c(!1),S=c(!1),k=c(!1),D=c(!1),h=c(!1),V=c([]),G=c({"Content-Type":"multipart/form-data"}),s=c({userId:0,version:"",platform:"",description:""}),r=c({id:0,fileName:"",version:"",platform:"",status:"",description:""}),x=c([]),v=ye({page:1,pageSize:10}),M=c({total:0,list:[]}),I=()=>{const a=localStorage.getItem("userInfo");return a?JSON.parse(a):null},H=a=>({windows:"Windows",linux:"Linux",macos:"macOS",android:"Android",ios:"iOS"})[a]||a,J=a=>{if(a===0)return"0 B";const e=1024,p=["B","KB","MB","GB","TB"],f=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,f)).toFixed(2))+" "+p[f]},Q=a=>new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),q=a=>({uploaded:"info",verified:"success",active:"primary",archived:"warning"})[a]||"info",X=a=>({uploaded:"已上传",verified:"已验证",active:"活跃",archived:"已归档"})[a]||a,Y=(a,e)=>{V.value=[e[0]]},Z=(a,e)=>{V.value=e},ee=a=>a.size/1024/1024<1024?!0:(n.error("单个文件大小不能超过1024MB!"),!1),le=()=>{if(V.value.length>0){const a=V.value[0].raw;if(a){const e=new FormData;e.append("file",a),e.append("userId",s.value.userId.toString()),s.value.version&&e.append("version",s.value.version),s.value.platform&&e.append("platform",s.value.platform),s.value.description&&e.append("description",s.value.description),k.value=!0,U.post(j,e,{headers:{"Content-Type":"multipart/form-data"}}).then(p=>{N(p.data)}).catch(p=>{T(p)}).finally(()=>{k.value=!1})}else n.warning("请先选择要上传的文件")}else n.warning("请先选择要上传的文件")},N=a=>{a.success?(n.success("文件上传成功"),C.value=!1,V.value=[],s.value.version="",s.value.platform="",s.value.description="",y()):n.error("文件上传失败: "+a.message)},T=a=>{n.error("文件上传失败: "+a.message)},y=()=>{const a=I();a&&(h.value=!0,U.get(`/api/installer-files/user/${a.id}`,{params:{page:v.page,pageSize:v.pageSize}}).then(e=>{e.data.success?M.value={total:e.data.total,list:e.data.list||[]}:n.error("获取文件列表失败: "+e.data.message)}).catch(e=>{n.error("获取文件列表失败: "+e.message)}).finally(()=>{h.value=!1}))},ae=a=>{r.value={id:a.id,fileName:a.fileName,version:a.version||"",platform:a.platform||"",status:a.status||"uploaded",description:a.description||""},S.value=!0},te=()=>{D.value=!0,U.put("/api/installer-files",r.value).then(a=>{a.data.success?(n.success("文件信息更新成功"),S.value=!1,y()):n.error("文件信息更新失败: "+a.data.message)}).catch(a=>{n.error("文件信息更新失败: "+a.message)}).finally(()=>{D.value=!1})},oe=a=>{x.value=a.map(e=>e.id)},se=a=>{K.confirm("确定要删除这个安装程序吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=!0,U.delete(`/api/installer-files/${a}`).then(e=>{e.data.success?(n.success("文件删除成功"),y()):n.error("文件删除失败: "+e.data.message)}).catch(e=>{n.error("文件删除失败: "+e.message)}).finally(()=>{h.value=!1})}).catch(()=>{})},ne=()=>{if(x.value.length===0){n.warning("请选择要删除的文件");return}K.confirm(`确定要删除选中的 ${x.value.length} 个安装程序吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{h.value=!0,U.delete("/api/installer-files/batch",{data:x.value}).then(a=>{a.data.success?(n.success("批量删除成功"),x.value=[],y()):n.error("批量删除失败: "+a.data.message)}).catch(a=>{n.error("批量删除失败: "+a.message)}).finally(()=>{h.value=!1})}).catch(()=>{})},ie=a=>{v.pageSize=a,v.page=1,y()},de=a=>{v.page=a,y()},ue=a=>{window.open(`/api/installer-files/download/${a}`,"_blank")};return ge(()=>{const a=I();a&&(s.value.userId=a.id),y()}),(a,e)=>{const p=i("el-icon"),f=i("el-button"),g=i("el-table-column"),re=i("el-tag"),pe=i("el-table"),fe=i("el-pagination"),me=i("el-upload"),z=i("el-input"),_=i("el-form-item"),b=i("el-col"),d=i("el-option"),E=i("el-select"),F=i("el-row"),$=i("el-form"),L=i("el-dialog"),ce=Ve("loading");return A(),_e("div",ze,[m("div",Ue,[e[17]||(e[17]=m("h2",null,"安装程序",-1)),m("div",ke,[l(f,{type:"danger",disabled:x.value.length===0,onClick:ne},{default:t(()=>[l(p,null,{default:t(()=>[l(w(P))]),_:1}),e[15]||(e[15]=u(" 批量删除 ",-1))]),_:1},8,["disabled"]),l(f,{type:"primary",onClick:e[0]||(e[0]=o=>C.value=!0)},{icon:t(()=>[l(w(R))]),default:t(()=>[e[16]||(e[16]=u(" 上传安装程序 ",-1))]),_:1})])]),m("div",Me,[M.value.list.length>0?be((A(),we(pe,{key:0,data:M.value.list,style:{width:"100%"},border:"",stripe:"","empty-text":"暂无数据",onSelectionChange:oe},{default:t(()=>[l(g,{type:"selection",width:"55"}),l(g,{prop:"fileName",label:"文件名",width:"200"}),l(g,{prop:"version",label:"版本号",width:"120"}),l(g,{prop:"platform",label:"平台",width:"120"},{default:t(o=>[u(B(H(o.row.platform)),1)]),_:1}),l(g,{prop:"fileSize",label:"大小",width:"120"},{default:t(o=>[u(B(J(o.row.fileSize)),1)]),_:1}),l(g,{prop:"uploadTime",label:"上传时间",width:"180"},{default:t(o=>[u(B(Q(o.row.uploadTime)),1)]),_:1}),l(g,{prop:"status",label:"状态",width:"120"},{default:t(o=>[l(re,{type:q(o.row.status)},{default:t(()=>[u(B(X(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(g,{prop:"description",label:"描述","show-overflow-tooltip":""}),l(g,{label:"操作",width:"200",fixed:"right"},{default:t(o=>[m("div",Be,[l(f,{type:"primary",size:"small",onClick:O=>ae(o.row)},{default:t(()=>[l(p,null,{default:t(()=>[l(w(W))]),_:1}),e[18]||(e[18]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),l(f,{type:"danger",size:"small",onClick:O=>se(o.row.id)},{default:t(()=>[l(p,null,{default:t(()=>[l(w(P))]),_:1}),e[19]||(e[19]=u(" 删除 ",-1))]),_:1},8,["onClick"]),l(f,{type:"success",size:"small",onClick:O=>ue(o.row.id)},{default:t(()=>[l(p,null,{default:t(()=>[l(w(xe))]),_:1}),e[20]||(e[20]=u(" 下载 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ce,h.value]]):he("",!0),m("div",De,[l(fe,{"current-page":v.page,"onUpdate:currentPage":e[1]||(e[1]=o=>v.page=o),"page-size":v.pageSize,"onUpdate:pageSize":e[2]||(e[2]=o=>v.pageSize=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:M.value.total,onSizeChange:ie,onCurrentChange:de},null,8,["current-page","page-size","total"])])]),l(L,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=o=>C.value=o),title:"上传安装程序",width:"600px","destroy-on-close":""},{footer:t(()=>[m("span",Ie,[l(f,{onClick:e[6]||(e[6]=o=>C.value=!1),disabled:k.value},{default:t(()=>[...e[23]||(e[23]=[u("取消",-1)])]),_:1},8,["disabled"]),l(f,{type:"primary",onClick:le,loading:k.value},{default:t(()=>[l(p,null,{default:t(()=>[l(w(Ce))]),_:1}),e[24]||(e[24]=u(" 开始上传 ",-1))]),_:1},8,["loading"])])]),default:t(()=>[l(me,{class:"upload-demo",drag:"",action:j,headers:G.value,data:s.value,"file-list":V.value,"auto-upload":!1,"on-success":N,"on-error":T,"before-upload":ee,"on-change":Z,limit:1,"on-exceed":Y},{tip:t(()=>[...e[21]||(e[21]=[m("div",{class:"el-upload__tip"}," 支持所有文件类型，单个文件大小不超过1024MB ",-1)])]),default:t(()=>[l(p,{class:"el-icon--upload"},{default:t(()=>[l(w(R))]),_:1}),e[22]||(e[22]=m("div",{class:"el-upload__text"},[u(" 拖动文件到此处，或"),m("em",null,"点击上传")],-1))]),_:1},8,["headers","data","file-list"]),m("div",Ee,[l($,{model:s.value,"label-width":"80px",size:"small"},{default:t(()=>[l(F,{gutter:20},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(_,{label:"版本号"},{default:t(()=>[l(z,{modelValue:s.value.version,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.version=o),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(_,{label:"平台"},{default:t(()=>[l(E,{modelValue:s.value.platform,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.platform=o),placeholder:"请选择平台"},{default:t(()=>[l(d,{label:"Windows",value:"windows"}),l(d,{label:"Linux",value:"linux"}),l(d,{label:"macOS",value:"macos"}),l(d,{label:"Android",value:"android"}),l(d,{label:"iOS",value:"ios"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(b,{span:24},{default:t(()=>[l(_,{label:"描述"},{default:t(()=>[l(z,{modelValue:s.value.description,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.description=o),type:"textarea",rows:2,placeholder:"请输入文件描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),l(L,{modelValue:S.value,"onUpdate:modelValue":e[14]||(e[14]=o=>S.value=o),title:"编辑安装程序",width:"600px","destroy-on-close":""},{footer:t(()=>[m("span",Ne,[l(f,{onClick:e[13]||(e[13]=o=>S.value=!1)},{default:t(()=>[...e[25]||(e[25]=[u("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:te,loading:D.value},{default:t(()=>[l(p,null,{default:t(()=>[l(w(W))]),_:1}),e[26]||(e[26]=u(" 保存修改 ",-1))]),_:1},8,["loading"])])]),default:t(()=>[l($,{model:r.value,"label-width":"80px",size:"small"},{default:t(()=>[l(F,{gutter:20},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(_,{label:"文件名"},{default:t(()=>[l(z,{modelValue:r.value.fileName,"onUpdate:modelValue":e[8]||(e[8]=o=>r.value.fileName=o),disabled:"",placeholder:"文件名"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(_,{label:"版本号"},{default:t(()=>[l(z,{modelValue:r.value.version,"onUpdate:modelValue":e[9]||(e[9]=o=>r.value.version=o),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(_,{label:"平台"},{default:t(()=>[l(E,{modelValue:r.value.platform,"onUpdate:modelValue":e[10]||(e[10]=o=>r.value.platform=o),placeholder:"请选择平台"},{default:t(()=>[l(d,{label:"Windows",value:"windows"}),l(d,{label:"Linux",value:"linux"}),l(d,{label:"macOS",value:"macos"}),l(d,{label:"Android",value:"android"}),l(d,{label:"iOS",value:"ios"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(_,{label:"状态"},{default:t(()=>[l(E,{modelValue:r.value.status,"onUpdate:modelValue":e[11]||(e[11]=o=>r.value.status=o),placeholder:"请选择状态"},{default:t(()=>[l(d,{label:"已上传",value:"uploaded"}),l(d,{label:"已验证",value:"verified"}),l(d,{label:"活跃",value:"active"}),l(d,{label:"已归档",value:"archived"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(b,{span:24},{default:t(()=>[l(_,{label:"描述"},{default:t(()=>[l(z,{modelValue:r.value.description,"onUpdate:modelValue":e[12]||(e[12]=o=>r.value.description=o),type:"textarea",rows:3,placeholder:"请输入文件描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ae=Se(Te,[["__scopeId","data-v-a0d8dff6"]]);export{Ae as default};
