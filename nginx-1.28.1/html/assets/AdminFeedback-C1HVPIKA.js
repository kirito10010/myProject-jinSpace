import{d as ne,k as se,c as re,a as k,b as a,w as o,h as r,i as F,E as s,r as u,o as ue,e as U,M as N,g as c,D as h,O as de,P as A}from"./index-10ag5i-E.js";import{g as ie,u as ce,d as pe,b as ge}from"./feedback-DqCYuekG.js";import{g as fe}from"./users-DRmlvM1q.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-BYh0DQqL.js";import"./index-B9ygI19o.js";const be={class:"admin-feedback"},ve={class:"toolbar"},_e={class:"pagination"},ye={class:"dialog-footer"},we=ne({__name:"AdminFeedback",setup(ke){const L=r([]),$=r([]),S=r(!1),B=r(!1),V=r(),v=r(!1),I=r(!1),y=r(!1),E=r(0),T=r(!1),C=r(0),x=r(!1),m=r([]),d=F({current:1,pageSize:10,total:0}),n=F({id:0,uid:0,content:"",contact:"",feedbackType:1,status:1}),P=F({uid:[{required:!0,message:"请输入用户ID",trigger:"blur"},{type:"number",message:"用户ID必须为数字",trigger:"blur"}],content:[{required:!0,message:"请输入反馈内容",trigger:"blur"},{min:1,max:1e3,message:"反馈内容长度在 1 到 1000 个字符",trigger:"blur"}],feedbackType:[{required:!0,message:"请选择反馈类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),R=t=>({1:"建议",2:"问题",3:"投诉",4:"其他"})[t]||"未知类型",j=t=>({1:"success",2:"warning",3:"danger",4:"info"})[t]||"info",H=t=>({1:"待处理",2:"处理中",3:"已处理",4:"已关闭"})[t]||"未知状态",O=t=>({1:"info",2:"warning",3:"success",4:"danger"})[t]||"info",Y=t=>{if(!t)return"";const e=new Date(t),g=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),w=String(e.getHours()).padStart(2,"0"),z=String(e.getMinutes()).padStart(2,"0"),M=String(e.getSeconds()).padStart(2,"0");return`${g}-${f}-${i} ${w}:${z}:${M}`},G=t=>{const e=$.value.find(g=>g.id===t);return e?e.nickname:t.toString()},J=async()=>{try{B.value=!0;const t=await fe();t.success?$.value=t.data:s.error(t.message||"获取用户列表失败")}catch(t){s.error("获取用户列表失败："+t.message)}finally{B.value=!1}},b=async()=>{try{S.value=!0;const t={page:d.current,pageSize:d.pageSize},e=await ie(t);e.success?(L.value=e.data,d.total=e.data.length):s.error(e.message||"获取反馈列表失败")}catch(t){s.error("获取反馈列表失败："+t.message)}finally{S.value=!1}},K=t=>{m.value=t.map(e=>e.id)},Q=t=>{n.id=t.id,n.uid=t.uid,n.content=t.content,n.contact=t.contact||"",n.feedbackType=t.feedbackType,n.status=t.status||1,I.value=!0,E.value=t.id,v.value=!0},W=async()=>{if(V.value)try{await V.value.validate(),y.value=!0;const t=await ce(n);t.success?(s.success("更新反馈成功"),v.value=!1,b()):s.error(t.message||"更新反馈失败")}catch(t){t!=="cancel"&&s.error("更新反馈失败："+t.message)}finally{y.value=!1}},X=t=>{A.confirm("确定要删除这条反馈吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{C.value=t.id,T.value=!0;const e=await pe(t.id);e.success?(s.success("删除反馈成功"),b()):s.error(e.message||"删除反馈失败")}catch(e){e!=="cancel"&&s.error("删除反馈失败："+e.message)}finally{T.value=!1,C.value=0}}).catch(()=>{})},Z=()=>{if(m.value.length===0){s.warning("请选择要删除的反馈");return}A.confirm(`确定要删除选中的 ${m.value.length} 条反馈吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{x.value=!0;const t=await ge(m.value);t.success?(s.success("批量删除反馈成功"),b(),m.value=[]):s.error(t.message||"批量删除反馈失败")}catch(t){t!=="cancel"&&s.error("批量删除反馈失败："+t.message)}finally{x.value=!1}}).catch(()=>{})},ee=t=>{d.pageSize=t,b()},te=t=>{d.current=t,b()};return se(async()=>{await J(),await b()}),(t,e)=>{const g=u("el-icon"),f=u("el-button"),i=u("el-table-column"),w=u("el-tag"),z=u("el-table"),M=u("el-pagination"),D=u("el-input"),_=u("el-form-item"),p=u("el-option"),q=u("el-select"),ae=u("el-form"),le=u("el-dialog");return ue(),re("div",be,[e[14]||(e[14]=k("h1",null,"意见反馈",-1)),k("div",ve,[a(f,{type:"danger",disabled:m.value.length===0,onClick:Z,loading:x.value},{default:o(()=>[a(g,null,{default:o(()=>[a(U(N))]),_:1}),e[9]||(e[9]=c(" 批量删除 ",-1))]),_:1},8,["disabled","loading"])]),a(z,{data:L.value,style:{width:"100%"},onSelectionChange:K,loading:S.value,stripe:"",border:""},{default:o(()=>[a(i,{type:"selection",width:"55"}),a(i,{prop:"uid",label:"用户昵称",width:"120"},{default:o(l=>[c(h(G(l.row.uid)),1)]),_:1}),a(i,{prop:"content",label:"反馈内容","min-width":"300","show-overflow-tooltip":""}),a(i,{prop:"contact",label:"联系方式",width:"180","show-overflow-tooltip":""}),a(i,{prop:"feedbackType",label:"反馈类型",width:"120"},{default:o(l=>[a(w,{type:j(l.row.feedbackType)},{default:o(()=>[c(h(R(l.row.feedbackType)),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"status",label:"状态",width:"120"},{default:o(l=>[a(w,{type:O(l.row.status)},{default:o(()=>[c(h(H(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"createTime",label:"创建时间",width:"180"},{default:o(l=>[c(h(Y(l.row.createTime)),1)]),_:1}),a(i,{label:"操作",width:"180",fixed:"right"},{default:o(l=>[a(f,{type:"primary",size:"small",onClick:oe=>Q(l.row),loading:y.value&&E.value===l.row.id},{default:o(()=>[a(g,null,{default:o(()=>[a(U(de))]),_:1}),e[10]||(e[10]=c(" 修改 ",-1))]),_:1},8,["onClick","loading"]),a(f,{type:"danger",size:"small",onClick:oe=>X(l.row),loading:T.value&&C.value===l.row.id},{default:o(()=>[a(g,null,{default:o(()=>[a(U(N))]),_:1}),e[11]||(e[11]=c(" 删除 ",-1))]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data","loading"]),k("div",_e,[a(M,{"current-page":d.current,"onUpdate:currentPage":e[0]||(e[0]=l=>d.current=l),"page-size":d.pageSize,"onUpdate:pageSize":e[1]||(e[1]=l=>d.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:d.total,onSizeChange:ee,onCurrentChange:te},null,8,["current-page","page-size","total"])]),a(le,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=l=>v.value=l),title:I.value?"修改反馈":"添加反馈",width:"500px","destroy-on-close":""},{footer:o(()=>[k("span",ye,[a(f,{onClick:e[7]||(e[7]=l=>v.value=!1)},{default:o(()=>[...e[12]||(e[12]=[c("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:W,loading:y.value},{default:o(()=>[...e[13]||(e[13]=[c(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[a(ae,{model:n,rules:P,ref_key:"editFormRef",ref:V,"label-width":"80px"},{default:o(()=>[a(_,{label:"用户ID",prop:"uid"},{default:o(()=>[a(D,{modelValue:n.uid,"onUpdate:modelValue":e[2]||(e[2]=l=>n.uid=l),placeholder:"用户ID"},null,8,["modelValue"])]),_:1}),a(_,{label:"反馈内容",prop:"content"},{default:o(()=>[a(D,{modelValue:n.content,"onUpdate:modelValue":e[3]||(e[3]=l=>n.content=l),type:"textarea",rows:4,placeholder:"反馈内容"},null,8,["modelValue"])]),_:1}),a(_,{label:"联系方式",prop:"contact"},{default:o(()=>[a(D,{modelValue:n.contact,"onUpdate:modelValue":e[4]||(e[4]=l=>n.contact=l),placeholder:"联系方式"},null,8,["modelValue"])]),_:1}),a(_,{label:"反馈类型",prop:"feedbackType"},{default:o(()=>[a(q,{modelValue:n.feedbackType,"onUpdate:modelValue":e[5]||(e[5]=l=>n.feedbackType=l),placeholder:"请选择反馈类型"},{default:o(()=>[a(p,{label:"建议",value:1}),a(p,{label:"问题",value:2}),a(p,{label:"投诉",value:3}),a(p,{label:"其他",value:4})]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"状态",prop:"status"},{default:o(()=>[a(q,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=l=>n.status=l),placeholder:"请选择状态"},{default:o(()=>[a(p,{label:"待处理",value:1}),a(p,{label:"处理中",value:2}),a(p,{label:"已处理",value:3}),a(p,{label:"已关闭",value:4})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),ze=me(we,[["__scopeId","data-v-5d19ec00"]]);export{ze as default};
