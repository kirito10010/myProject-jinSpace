import{d as le,k as re,c as N,a as g,b as a,w as r,K as oe,z as ne,h as v,i as T,E as u,r as p,L as se,o as R,e as w,M as L,g as f,N as ie,C as ue,D as U,O as ce,n as de,s as me,P as F}from"./index-CrvSzVLO.js";import{s as $}from"./request-BYh0DQqL.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B9ygI19o.js";const fe=c=>$.get("/api/bookmarks",{params:c}),ge=c=>$.post("/api/bookmarks",c),ve=(c,d)=>$.put(`/api/bookmarks/${c}`,d),_e=c=>$.delete(`/api/bookmarks/${c}`),he=c=>$.delete("/api/bookmarks/batch",{data:c}),ke={class:"resource-url-container"},be={class:"page-header"},ye={class:"header-buttons"},we={class:"table-container"},Se={class:"url-item"},Ce=["src","alt","onError"],xe=["href"],ze={class:"pagination-container"},$e={class:"dialog-footer"},Ue=le({__name:"ResourceUrl",setup(c){const d=v(!1),V=v(!1),k=v(!1),S=v(),b=v([]),_=v(!1),B=v(0),o=T({url:"",title:"",remark:""}),O={url:[{required:!0,message:"请输入网址URL",trigger:"blur"},{type:"url",message:"请输入有效的URL格式",trigger:"blur"}]},m=T({page:1,pageSize:10}),h=v({total:0,list:[]}),j=t=>{if(!t)return"-";try{const e=new Date(t);if(isNaN(e.getTime()))return"-";const n=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),C=String(e.getHours()).padStart(2,"0"),x=String(e.getMinutes()).padStart(2,"0"),z=String(e.getSeconds()).padStart(2,"0");return`${n}-${s}-${i} ${C}:${x}:${z}`}catch(e){return console.error("日期格式化错误:",e),"-"}},P=()=>{o.url&&!/^https?:\/\//i.test(o.url)&&(o.url=`https://${o.url}`)},D=t=>{if(!t)return"";try{return new URL(t).hostname}catch{return t.match(/^(?:https?:\/\/)?([^:/?#]+)/i)?.[1]||""}},q=t=>{const e=D(t);if(!e)return"";const n=[`https://www.google.com/s2/favicons?domain=${e}&sz=16`,`https://f1.allesedv.com/16/${e}`,`https://icon.horse/icon/${e}`],s=Math.floor(Math.random()*n.length);return n[s]||""},A=(t,e)=>{const n=t.target;if(!n||!e)return;const s=D(e);if(!s){n.style.display="none";return}const i=[`https://f1.allesedv.com/16/${s}`,`https://icon.horse/icon/${s}`],C=Math.floor(Math.random()*i.length),x=i[C]||"";n.src=x,n.onerror=()=>{n.style.display="none"}},H=t=>{b.value=t.map(e=>e.id)},J=()=>{_.value=!1,B.value=0,E(),k.value=!0},K=t=>{_.value=!0,B.value=t.id,o.url=t.url,o.title=t.title||"",o.remark=t.remark||"",k.value=!0},Y=async()=>{if(S.value)try{await S.value.validate(),V.value=!0;let t;_.value?t=await ve(B.value,o):t=await ge(o),t.success?(u.success(_.value?"编辑成功":"添加成功"),k.value=!1,E(),y()):u.error(t.message||(_.value?"编辑失败":"添加失败"))}catch(t){u.error((_.value?"编辑失败":"添加失败")+"："+(t.message||"未知错误"))}finally{V.value=!1}},G=async t=>{try{await F.confirm("确定要删除这个网址吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=!0;const e=await _e(t);e.success?(u.success("删除成功"),y()):u.error(e.message||"删除失败")}catch(e){e!=="cancel"&&u.error("删除失败："+(e.message||"未知错误"))}finally{d.value=!1}},Q=async()=>{if(b.value.length===0){u.warning("请选择要删除的网址");return}try{await F.confirm(`确定要删除选中的 ${b.value.length} 个网址吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=!0;const t=await he(b.value);t.success?(u.success("批量删除成功"),b.value=[],y()):u.error(t.message||"批量删除失败")}catch(t){t!=="cancel"&&u.error("批量删除失败："+(t.message||"未知错误"))}finally{d.value=!1}},E=()=>{S.value&&S.value.resetFields(),o.url="",o.title="",o.remark=""},W=()=>{try{const t=localStorage.getItem("userInfo");return t&&JSON.parse(t).id||1}catch(t){return console.error("获取用户信息失败：",t),1}},y=async()=>{try{d.value=!0;const t=W(),e=await fe({page:m.page,pageSize:m.pageSize,uid:t});h.value={total:e.total||e.list?.length||0,list:e.list||[]},h.value.list.length>0&&h.value.total===0&&(h.value.total=h.value.list.length)}catch(t){u.error("获取数据失败："+(t.message||"未知错误"))}finally{d.value=!1}},X=t=>{m.pageSize=t,m.page=1,y()},Z=t=>{m.page=t,y()};return re(()=>{y()}),(t,e)=>{const n=p("el-icon"),s=p("el-button"),i=p("el-table-column"),C=p("el-table"),x=p("el-pagination"),z=p("el-input"),I=p("el-form-item"),ee=p("el-form"),te=p("el-dialog"),ae=se("loading");return R(),N("div",ke,[g("div",be,[e[9]||(e[9]=g("h2",null,"网址链接",-1)),g("div",ye,[a(s,{type:"danger",disabled:b.value.length===0,onClick:Q},{default:r(()=>[a(n,null,{default:r(()=>[a(w(L))]),_:1}),e[7]||(e[7]=f(" 批量删除 ",-1))]),_:1},8,["disabled"]),a(s,{type:"primary",onClick:J},{default:r(()=>[a(n,null,{default:r(()=>[a(w(ie))]),_:1}),e[8]||(e[8]=f(" 添加网址 ",-1))]),_:1})])]),g("div",we,[oe((R(),ne(C,{data:h.value.list,style:{width:"100%"},border:"",stripe:"","empty-text":"暂无数据",onSelectionChange:H},{default:r(()=>[a(i,{type:"selection",width:"55"}),a(i,{prop:"url",label:"网址URL","min-width":"300"},{default:r(l=>[g("div",Se,[D(l.row.url)?(R(),N("img",{key:0,src:q(l.row.url),alt:l.row.url,class:"favicon",onError:M=>A(M,l.row.url)},null,40,Ce)):ue("",!0),g("a",{href:l.row.url,target:"_blank",rel:"noopener noreferrer",class:"url-link"},U(l.row.url),9,xe)])]),_:1}),a(i,{prop:"title",label:"标题","min-width":"200"},{default:r(l=>[f(U(l.row.title||"-"),1)]),_:1}),a(i,{prop:"remark",label:"备注","min-width":"250"},{default:r(l=>[f(U(l.row.remark||"-"),1)]),_:1}),a(i,{prop:"createdTime",label:"创建时间",width:"180",sortable:""},{default:r(l=>[f(U(j(l.row.createdTime)),1)]),_:1}),a(i,{label:"操作",width:"180",fixed:"right"},{default:r(l=>[a(s,{type:"primary",size:"small",onClick:M=>K(l.row)},{default:r(()=>[a(n,null,{default:r(()=>[a(w(ce))]),_:1}),e[10]||(e[10]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),a(s,{type:"danger",size:"small",onClick:M=>G(l.row.id)},{default:r(()=>[a(n,null,{default:r(()=>[a(w(L))]),_:1}),e[11]||(e[11]=f(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,d.value]]),g("div",ze,[a(x,{"current-page":m.page,"onUpdate:currentPage":e[0]||(e[0]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":e[1]||(e[1]=l=>m.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:h.value.total,onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),a(te,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),title:_.value?"编辑网址":"添加网址",width:"500px","close-on-click-modal":!1},{footer:r(()=>[g("span",$e,[a(s,{onClick:e[5]||(e[5]=l=>k.value=!1)},{default:r(()=>[...e[12]||(e[12]=[f("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:Y,loading:V.value},{default:r(()=>[...e[13]||(e[13]=[f(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:r(()=>[a(ee,{ref_key:"formRef",ref:S,model:o,rules:O,"label-width":"80px",class:"add-form"},{default:r(()=>[a(I,{label:"网址URL",prop:"url"},{default:r(()=>[a(z,{modelValue:o.url,"onUpdate:modelValue":e[2]||(e[2]=l=>o.url=l),placeholder:"请输入网址URL",clearable:"",onInput:P},{prefix:r(()=>[a(n,null,{default:r(()=>[a(w(de))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(I,{label:"标题",prop:"title"},{default:r(()=>[a(z,{modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=l=>o.title=l),placeholder:"请输入标题（选填）",clearable:""},{prefix:r(()=>[a(n,null,{default:r(()=>[a(w(me))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(I,{label:"备注",prop:"remark"},{default:r(()=>[a(z,{modelValue:o.remark,"onUpdate:modelValue":e[4]||(e[4]=l=>o.remark=l),placeholder:"请输入备注（选填）",type:"textarea",rows:3,resize:"vertical"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Me=pe(Ue,[["__scopeId","data-v-1f3ba128"]]);export{Me as default};
