import{d as Y,k as G,c as D,a as u,b as r,w as o,A as K,B as Q,h as v,i as I,E as h,r as s,C as W,o as C,e as x,D as X,g as p,F as Z,x as w,n as ee,s as te}from"./index-8fw8rqfs.js";import{s as $}from"./request-Z1Oqv7c5.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=k=>$.get("/api/bookmarks",{params:k}),oe=k=>$.post("/api/bookmarks",k),le={class:"resource-url-container"},ne={class:"page-header"},se={class:"table-container"},ie={class:"url-item"},ue=["src","alt"],de=["href"],ce={class:"pagination-container"},pe={class:"dialog-footer"},me=Y({__name:"ResourceUrl",setup(k){const y=v(!1),S=v(!1),m=v(!1),g=v(),l=I({url:"",title:"",remark:""}),B={url:[{required:!0,message:"请输入网址URL",trigger:"blur"},{type:"url",message:"请输入有效的URL格式",trigger:"blur"}]},n=I({page:1,pageSize:20}),i=v({total:0,list:[]}),N=t=>{if(!t)return"-";try{const e=new Date(t);if(isNaN(e.getTime()))return"-";const d=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),V=String(e.getHours()).padStart(2,"0"),U=String(e.getMinutes()).padStart(2,"0"),_=String(e.getSeconds()).padStart(2,"0");return`${d}-${f}-${c} ${V}:${U}:${_}`}catch(e){return console.error("日期格式化错误:",e),"-"}},F=()=>{l.url&&!/^https?:\/\//i.test(l.url)&&(l.url=`https://${l.url}`)},R=t=>{if(!t)return"";try{return new URL(t).hostname}catch{return t.match(/^(?:https?:\/\/)?([^:/?#]+)/i)?.[1]||""}},L=t=>{const e=t.target;e&&(e.style.display="none")},E=()=>{m.value=!0},M=async()=>{if(g.value)try{await g.value.validate(),S.value=!0;const t=await oe(l);t.success?(h.success("添加成功"),m.value=!1,T(),b()):h.error(t.message||"添加失败")}catch(t){h.error("添加失败："+(t.message||"未知错误"))}finally{S.value=!1}},T=()=>{g.value&&g.value.resetFields(),l.url="",l.title="",l.remark=""},j=()=>{try{const t=localStorage.getItem("userInfo");return t&&JSON.parse(t).id||1}catch(t){return console.error("获取用户信息失败：",t),1}},b=async()=>{try{y.value=!0;const t=j(),e=await re({page:n.page,pageSize:n.pageSize,uid:t});i.value={total:e.total||e.list?.length||0,list:e.list||[]},i.value.list.length>0&&i.value.total===0&&(i.value.total=i.value.list.length)}catch(t){h.error("获取数据失败："+(t.message||"未知错误"))}finally{y.value=!1}},O=t=>{n.pageSize=t,n.page=1,b()},A=t=>{n.page=t,b()};return G(()=>{b()}),(t,e)=>{const d=s("el-icon"),f=s("el-button"),c=s("el-table-column"),V=s("el-table"),U=s("el-pagination"),_=s("el-input"),z=s("el-form-item"),q=s("el-form"),H=s("el-dialog"),J=W("loading");return C(),D("div",le,[u("div",ne,[e[9]||(e[9]=u("h2",null,"网址链接",-1)),r(f,{type:"primary",onClick:E},{default:o(()=>[r(d,null,{default:o(()=>[r(x(X))]),_:1}),e[8]||(e[8]=p(" 添加网址 ",-1))]),_:1})]),u("div",se,[K((C(),Q(V,{data:i.value.list,style:{width:"100%"},border:"",stripe:"","empty-text":"暂无数据"},{default:o(()=>[r(c,{prop:"url",label:"网址URL","min-width":"300"},{default:o(a=>[u("div",ie,[R(a.row.url)?(C(),D("img",{key:0,src:`https://www.google.com/s2/favicons?domain=${R(a.row.url)}&sz=16`,alt:a.row.url,class:"favicon",onError:e[0]||(e[0]=P=>L(P))},null,40,ue)):Z("",!0),u("a",{href:a.row.url,target:"_blank",rel:"noopener noreferrer",class:"url-link"},w(a.row.url),9,de)])]),_:1}),r(c,{prop:"title",label:"标题","min-width":"200"},{default:o(a=>[p(w(a.row.title||"-"),1)]),_:1}),r(c,{prop:"remark",label:"备注","min-width":"250"},{default:o(a=>[p(w(a.row.remark||"-"),1)]),_:1}),r(c,{prop:"createdTime",label:"创建时间",width:"180",sortable:""},{default:o(a=>[p(w(N(a.row.createdTime)),1)]),_:1})]),_:1},8,["data"])),[[J,y.value]]),u("div",ce,[r(U,{"current-page":n.page,"onUpdate:currentPage":e[1]||(e[1]=a=>n.page=a),"page-size":n.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>n.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:i.value.total,onSizeChange:O,onCurrentChange:A},null,8,["current-page","page-size","total"])])]),r(H,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:"添加网址",width:"500px","close-on-click-modal":!1},{footer:o(()=>[u("span",pe,[r(f,{onClick:e[6]||(e[6]=a=>m.value=!1)},{default:o(()=>[...e[10]||(e[10]=[p("取消",-1)])]),_:1}),r(f,{type:"primary",onClick:M,loading:S.value},{default:o(()=>[...e[11]||(e[11]=[p(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[r(q,{ref_key:"formRef",ref:g,model:l,rules:B,"label-width":"80px",class:"add-form"},{default:o(()=>[r(z,{label:"网址URL",prop:"url"},{default:o(()=>[r(_,{modelValue:l.url,"onUpdate:modelValue":e[3]||(e[3]=a=>l.url=a),placeholder:"请输入网址URL",clearable:"",onInput:F},{prefix:o(()=>[r(d,null,{default:o(()=>[r(x(ee))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(z,{label:"标题",prop:"title"},{default:o(()=>[r(_,{modelValue:l.title,"onUpdate:modelValue":e[4]||(e[4]=a=>l.title=a),placeholder:"请输入标题（选填）",clearable:""},{prefix:o(()=>[r(d,null,{default:o(()=>[r(x(te))]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(z,{label:"备注",prop:"remark"},{default:o(()=>[r(_,{modelValue:l.remark,"onUpdate:modelValue":e[5]||(e[5]=a=>l.remark=a),placeholder:"请输入备注（选填）",type:"textarea",rows:3,resize:"vertical"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ve=ae(me,[["__scopeId","data-v-52ae6a41"]]);export{ve as default};
