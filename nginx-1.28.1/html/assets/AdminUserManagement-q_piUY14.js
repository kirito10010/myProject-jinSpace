import{d as H,k as J,c as K,a as h,b as l,w as o,h as u,E as r,r as n,o as Q,e as C,M as D,g as i,D as q,O as W,i as E,P as I}from"./index-CuCVz4vD.js";import{g as X,u as Y,d as ee,b as le}from"./users-DRmlvM1q.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-BYh0DQqL.js";import"./index-B9ygI19o.js";const te={class:"admin-user-management"},se={class:"toolbar"},oe={class:"dialog-footer"},re=H({__name:"AdminUserManagement",setup(ne){const B=u([]),w=u(!1),y=u(),p=u(!1),_=u(!1),M=u(0),V=u(!1),k=u(0),x=u(!1),c=u([]),t=E({id:0,username:"",password:"",nickname:"",email:"",role:3,status:1}),L=E({username:[{required:!0,message:"请输入登录账号",trigger:"blur"},{min:3,max:50,message:"登录账号长度在 3 到 50 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"登录账号只能包含字母、数字和下划线",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],role:[{required:!0,message:"请选择用户角色",trigger:"change"}],status:[{required:!0,message:"请选择账号状态",trigger:"change"}],password:[{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]}),S=a=>({1:"超级管理员",2:"管理员",3:"普通成员"})[a]||"未知角色",$=a=>a===1?"正常":"禁用",v=async()=>{try{w.value=!0;const a=await X();a.success?B.value=a.data:r.error(a.message||"获取用户列表失败")}catch(a){r.error("获取用户列表失败："+a.message)}finally{w.value=!1}},z=a=>{c.value=a.map(e=>e.id)},F=a=>{t.id=a.id,t.username=a.username,t.nickname=a.nickname,t.email=a.email,t.role=a.role,t.status=a.status,t.password="",M.value=a.id,p.value=!0},N=async()=>{if(y.value)try{await y.value.validate(),_.value=!0;const a={username:t.username,nickname:t.nickname,email:t.email,role:t.role,status:t.status};t.password&&(a.password=t.password);const e=await Y(t.id,a);e.success?(r.success("更新用户成功"),p.value=!1,v()):r.error(e.message||"更新用户失败")}catch(a){r.error("更新用户失败："+a.message)}finally{_.value=!1}},R=async a=>{try{await I.confirm("确定要删除该用户吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=a.id,V.value=!0;const e=await ee(a.id);e.success?(r.success("删除用户成功"),v()):r.error(e.message||"删除用户失败")}catch(e){e!=="cancel"&&r.error("删除用户失败："+e.message)}finally{V.value=!1,k.value=0}},O=async()=>{if(c.value.length===0){r.warning("请选择要删除的用户");return}try{await I.confirm("确定要删除选中的用户吗？","批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!0;const a=await le(c.value);a.success?(r.success("批量删除用户成功"),v(),c.value=[]):r.error(a.message||"批量删除用户失败")}catch(a){a!=="cancel"&&r.error("批量删除用户失败："+a.message)}finally{x.value=!1}};return J(()=>{v()}),(a,e)=>{const U=n("el-icon"),g=n("el-button"),d=n("el-table-column"),A=n("el-tag"),P=n("el-table"),b=n("el-input"),m=n("el-form-item"),f=n("el-option"),T=n("el-select"),Z=n("el-form"),j=n("el-dialog");return Q(),K("div",te,[e[13]||(e[13]=h("h1",null,"用戶管理",-1)),h("div",se,[l(g,{type:"danger",disabled:c.value.length===0,onClick:O,loading:x.value},{default:o(()=>[l(U,null,{default:o(()=>[l(C(D))]),_:1}),e[8]||(e[8]=i(" 批量删除 ",-1))]),_:1},8,["disabled","loading"])]),l(P,{data:B.value,style:{width:"100%"},onSelectionChange:z,loading:w.value,stripe:"",border:""},{default:o(()=>[l(d,{type:"selection",width:"55"}),l(d,{prop:"username",label:"登录账号",width:"180"}),l(d,{prop:"nickname",label:"用户昵称",width:"180"}),l(d,{prop:"email",label:"邮箱","min-width":"200"}),l(d,{prop:"role",label:"用户权限",width:"120"},{default:o(s=>[l(A,{type:s.row.role===1?"danger":s.row.role===2?"warning":"success"},{default:o(()=>[i(q(S(s.row.role)),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"status",label:"账号状态",width:"120"},{default:o(s=>[l(A,{type:s.row.status===1?"success":"danger"},{default:o(()=>[i(q($(s.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"操作",width:"180",fixed:"right"},{default:o(s=>[l(g,{type:"primary",size:"small",onClick:G=>F(s.row),loading:_.value&&M.value===s.row.id},{default:o(()=>[l(U,null,{default:o(()=>[l(C(W))]),_:1}),e[9]||(e[9]=i(" 修改 ",-1))]),_:1},8,["onClick","loading"]),l(g,{type:"danger",size:"small",onClick:G=>R(s.row),loading:V.value&&k.value===s.row.id},{default:o(()=>[l(U,null,{default:o(()=>[l(C(D))]),_:1}),e[10]||(e[10]=i(" 删除 ",-1))]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data","loading"]),l(j,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=s=>p.value=s),title:"编辑用户",width:"500px","destroy-on-close":""},{footer:o(()=>[h("span",oe,[l(g,{onClick:e[6]||(e[6]=s=>p.value=!1)},{default:o(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:N,loading:_.value},{default:o(()=>[...e[12]||(e[12]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[l(Z,{model:t,rules:L,ref_key:"editFormRef",ref:y,"label-width":"80px"},{default:o(()=>[l(m,{label:"登录账号",prop:"username"},{default:o(()=>[l(b,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=s=>t.username=s),placeholder:"登录账号"},null,8,["modelValue"])]),_:1}),l(m,{label:"密码",prop:"password"},{default:o(()=>[l(b,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=s=>t.password=s),type:"password",placeholder:"不修改密码请留空","show-password":""},null,8,["modelValue"])]),_:1}),l(m,{label:"昵称",prop:"nickname"},{default:o(()=>[l(b,{modelValue:t.nickname,"onUpdate:modelValue":e[2]||(e[2]=s=>t.nickname=s),placeholder:"用户昵称"},null,8,["modelValue"])]),_:1}),l(m,{label:"邮箱",prop:"email"},{default:o(()=>[l(b,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.email=s),placeholder:"用户邮箱",type:"email"},null,8,["modelValue"])]),_:1}),l(m,{label:"角色",prop:"role"},{default:o(()=>[l(T,{modelValue:t.role,"onUpdate:modelValue":e[4]||(e[4]=s=>t.role=s),placeholder:"请选择用户角色"},{default:o(()=>[l(f,{label:"超级管理员",value:1}),l(f,{label:"管理员",value:2}),l(f,{label:"普通成员",value:3})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:o(()=>[l(T,{modelValue:t.status,"onUpdate:modelValue":e[5]||(e[5]=s=>t.status=s),placeholder:"请选择账号状态"},{default:o(()=>[l(f,{label:"正常",value:1}),l(f,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),ce=ae(re,[["__scopeId","data-v-4f0869c5"]]);export{ce as default};
